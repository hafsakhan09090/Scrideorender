<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrideo - AI Video Transcription</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body::before {
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0;
            background-image: radial-gradient(circle at top left, rgba(192, 132, 252, 0.1), transparent 30%),
                              radial-gradient(circle at bottom right, rgba(6, 182, 212, 0.1), transparent 30%);
            background-repeat: no-repeat; 
            background-attachment: fixed; 
            z-index: -1; 
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        
        body.light-theme {
            background: linear-gradient(90deg, #c5add9 , #9fdcf0 ) !important;
            color: #1a1a1a !important;
        }
        body.light-theme::before {
            background-image: radial-gradient(circle at top left, rgba(124, 58, 237, 0.12), transparent 40%),
                              radial-gradient(circle at bottom right, rgba(6, 182, 212, 0.12), transparent 40%),
                              radial-gradient(circle at center, rgba(192, 132, 252, 0.08), transparent 50%);
        }
        
        body.light-theme .card-bg { background-color: #bde6f4 !important; border-color: #ffffff !important; }
        body.light-theme .section-bg { background-color: #ffffff !important; border-color: #ffffff !important; }
        body.light-theme .inner-bg { background-color: #f1dfff !important; border-color: #ffffff !important; }
        body.light-theme .input-bg { background-color: #ffffff !important; border-color: #ffffff !important; color: #000000 !important; }
        body.light-theme .text-light { color: #000000 !important; }
        body.light-theme .text-lighter { color: #000000 !important; }
        body.light-theme .text-muted { color: #000000 !important; }
        body.light-theme .modal-bg { background-color: #ffffff !important; }
        body.light-theme .modal-close { color: #000000 !important; }
        body.light-theme .modal-close:hover { color: #000000 !important; }
        
        #transcription-box { white-space: pre-line; }
        .copy-btn:hover { cursor: pointer; }
        .copied-message { display: none; color: rgb(255, 255, 255); }
        #file-upload { display: none; }
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .status-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { margin: 15% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 400px; }
        .close { float: right; font-size: 24px; font-weight: bold; cursor: pointer; }
        .auth-buttons { z-index: 10; }
        .loading { opacity: 0.7; cursor: not-allowed; }
        .caption-preview {
            border-radius: 8px; 
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            position: relative;
        }
        .caption-preview-text {
            color: white;
            font-weight: bold;
            line-height: 1.4;
        }
        .history-item { transition: all 0.2s ease; }
        .history-item:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .notification-icon {
            flex-shrink: 0;
        }
        .notification-message {
            flex: 1;
        }
        .notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            flex-shrink: 0;
        }
        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Favorite star */
        .favorite-star {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .favorite-star:hover {
            transform: scale(1.2);
        }
        .favorite-star.favorited {
            color: #fbbf24;
            fill: #fbbf24;
        }
        .favorite-star:not(.favorited) {
            color: #6b7280;
        }

        /* History actions */
        .history-actions {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .history-item:hover .history-actions {
            opacity: 1;
        }

        /* Filter pills */
        .filter-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            font-size: 14px;
            color: #3b82f6;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .filter-pill:hover {
            background: rgba(59, 130, 246, 0.2);
        }
        .filter-pill.active {
            background: #3b82f6;
            color: white;
        }
        .filter-pill .close {
            font-size: 14px;
            margin-left: 4px;
            opacity: 0.7;
        }
        .filter-pill .close:hover {
            opacity: 1;
        }

        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal">
        <div class="modal-content modal-bg bg-gray-800 text-light text-white">
            <span class="close modal-close text-gray-400" onclick="closeModal('delete-confirm-modal')">&times;</span>
            <h2 class="text-2xl font-semibold mb-4">Confirm Delete</h2>
            <p class="mb-6 text-gray-300">Are you sure you want to delete this video from your history? This action cannot be undone.</p>
            <div class="flex gap-3">
                <button id="confirm-delete-btn" class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors">Delete</button>
                <button onclick="closeModal('delete-confirm-modal')" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold transition-colors">Cancel</button>
            </div>
        </div>
    </div>

    <main class="w-full max-w-8xl mx-auto relative">
        <div class="absolute top-0 right-0 flex gap-2 p-4 auth-buttons">
            <button id="theme-toggle" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold transition-colors flex items-center gap-2" title="Toggle theme">
                <svg id="theme-icon-sun" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-icon-moon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
            <button id="login-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-colors">Login</button>
            <button id="signup-btn" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold transition-colors">Signup</button>
            <button id="logout-btn" class="hidden px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors">Logout</button>
        </div>

        <!-- Login Modal -->
        <div id="login-modal" class="modal">
            <div class="modal-content modal-bg bg-gray-800 text-light text-white">
                <span class="close modal-close text-gray-400" onclick="closeModal('login-modal')">&times;</span>
                <h2 class="text-2xl font-semibold mb-4">Login</h2>
                <div id="login-error" class="text-red-400 hidden mb-4"></div>
                <div class="mb-4">
                    <label for="login-username" class="block text-sm font-medium text-lighter text-gray-300">Username</label>
                    <input type="text" id="login-username" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-white">
                </div>
                <div class="mb-4">
                    <label for="login-password" class="block text-sm font-medium text-lighter text-gray-300">Password</label>
                    <input type="password" id="login-password" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-white">
                </div>
                <button id="login-submit" class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">Login</button>
            </div>
        </div>

        <!-- Signup Modal -->
        <div id="signup-modal" class="modal">
            <div class="modal-content modal-bg bg-gray-800 text-light text-white">
                <span class="close modal-close text-gray-400" onclick="closeModal('signup-modal')">&times;</span>
                <h2 class="text-2xl font-semibold mb-4">Signup</h2>
                <div id="signup-error" class="text-red-400 hidden mb-4"></div>
                <div class="mb-4">
                    <label for="signup-username" class="block text-sm font-medium text-lighter text-gray-300">Username</label>
                    <input type="text" id="signup-username" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white">
                </div>
                <div class="mb-4">
                    <label for="signup-password" class="block text-sm font-medium text-lighter text-gray-300">Password</label>
                    <input type="password" id="signup-password" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white">
                </div>
                <div class="mb-4">
                    <label for="signup-password-confirm" class="block text-sm font-medium text-lighter text-gray-300">Confirm Password</label>
                    <input type="password" id="signup-password-confirm" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white">
                </div>
                <button id="signup-submit" class="w-full px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold">Signup</button>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile-section" class="hidden mt-6 section-bg bg-gray-800/50 backdrop-blur-md rounded-xl p-6 border border-gray-700">
            <h2 class="text-2xl font-semibold mb-4 text-light">User Profile</h2>
            <div id="profile-info" class="space-y-2">
                <pre class="text-lighter"><strong>Username: </strong> <span id="profile-username"></span></pre>
                <pre class="text-lighter"><strong>Total Videos Processed: </strong> <span id="profile-job-count"></span></pre>
                <pre class="text-lighter"><strong>Favorites: </strong> <span id="profile-favorite-count"></span></pre>
            </div>
        </div>

        <!-- Main Content -->
        <div class="card-bg bg-gray-800/50 backdrop-blur-md rounded-xl shadow-2xl shadow-purple-500/10 p-6 sm:p-8 border border-gray-700">
            <div class="text-center mb-8">
                <h1 class="text-8xl sm:text-8xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-cyan-500 mb-2">Scrideo</h1>
                <p class="text-light text-white text-lg sm:text-2xl">Generate videos with embedded subtitles or transcription text from YouTube or uploaded files</p>
            </div>

            <form id="transcribe-form">
                <div class="flex flex-col sm:flex-row gap-3">
                    <div class="flex gap-2 w-full">
                        <input type="url" id="youtube-url" placeholder="Paste a YouTube video link here..." class="input-bg flex-1 px-4 py-3 bg-white-700/50 border border-black-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition duration-300 placeholder-gray-500 text-black">
                        <button type="button" id="paste-btn" title="Paste from clipboard" class="px-4 py-3 bg-white hover:bg-gray-100 text-black border-2 border-black rounded-lg font-semibold transition-colors flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                            <span>Paste</span>
                        </button>
                    </div>
                    <button type="submit" id="submit-button" class="w-full sm:w-auto px-6 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-700 hover:to-cyan-700 rounded-lg font-semibold shadow-lg hover:shadow-purple-500/30 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                        <span>Generate</span>
                    </button>
                </div>

                <div class="my-6 flex items-center">
                    <div class="flex-grow border-t border-gray-700"></div>
                    <span class="flex-shrink mx-4 text-muted text-gray-500">OR</span>
                    <div class="flex-grow border-t border-gray-700"></div>
                </div>

                <div class="text-center">
                    <input type="file" id="file-upload" accept="video/*">
                    <label for="file-upload" class="cursor-pointer inline-block w-full px-6 py-3 border-2 border-dashed border-white-600 hover:border-cyan-500 text-gray-400 hover:text-cyan-400 rounded-lg transition-all duration-300">
                        <svg class="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-4-4V7a4 4 0 014-4h5l2 2h5a4 4 0 014 4v2a4 4 0 01-4 4H7z"></path></svg>
                        <span id="file-label-text">Click to upload a video file (MP4, AVI, MOV, MKV, WEBM, FLV, WMV, M4V, 3GP)</span>
                    </label>
                    <div id="file-actions" class="hidden mt-3 flex gap-2 justify-center">
                        <button type="button" id="delete-btn" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>
                    </div>
                </div>
            </form>

            <!-- Caption Customization -->
            <div class="mt-8 p-6 inner-bg bg-gray-900/60 border border-gray-700 rounded-lg">
                <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-light">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    Caption Customization
                </h3>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-4">
                    <!-- Font Family -->
                    <div>
                        <label for="caption-font" class="block text-sm font-medium text-lighter text-black-300 mb-2">Font Family</label>
                        <select id="caption-font" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="arial" selected>Arial</option>
                            <option value="helvetica">Helvetica</option>
                            <option value="times-new-roman">Times New Roman</option>
                            <option value="courier-new">Courier New</option>
                            <option value="verdana">Verdana</option>
                            <option value="georgia">Georgia</option>
                            <option value="impact">Impact</option>
                            <option value="comic-sans">Comic Sans MS</option>
                            <option value="trebuchet">Trebuchet MS</option>
                            <option value="arial-black">Arial Black</option>
                            <option value="palatino">Palatino Linotype</option>
                        </select>
                    </div>

                    <!-- Font Style -->
                    <div>
                        <label for="caption-font-style" class="block text-sm font-medium text-lighter text-black-300 mb-2">Font Style</label>
                        <select id="caption-font-style" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="normal" selected>Normal</option>
                            <option value="bold">Bold</option>
                            <option value="italic">Italic</option>
                            <option value="bold-italic">Bold Italic</option>
                        </select>
                    </div>

                    <!-- Font Size -->
                    <div>
                        <label for="caption-size" class="block text-sm font-medium text-lighter text-black-300 mb-2">Font Size</label>
                        <select id="caption-size" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="12">Small (12px)</option>
                            <option value="16">Small-Medium (16px)</option>
                            <option value="20" selected>Medium (20px)</option>
                            <option value="24">Large (24px)</option>
                            <option value="28">X-Large (28px)</option>
                            <option value="32">2X-Large (32px)</option>
                        </select>
                    </div>

                    <!-- Text Color -->
                    <div>
                        <label for="caption-color" class="block text-sm font-medium text-lighter text-black-300 mb-2">Text Color</label>
                        <select id="caption-color" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="white" selected>White</option>
                            <option value="yellow">Yellow</option>
                            <option value="cyan">Cyan</option>
                            <option value="lime">Lime Green</option>
                            <option value="orange">Orange</option>
                            <option value="red">Red</option>
                            <option value="pink">Pink</option>
                            <option value="purple">Purple</option>
                            <option value="light-blue">Light Blue</option>
                            <option value="light-green">Light Green</option>
                        </select>
                    </div>

                    <!-- Background Color -->
                    <div>
                        <label for="caption-bg-color" class="block text-sm font-medium text-lighter text-black-300 mb-2">Background Color</label>
                        <select id="caption-bg-color" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="none" selected>None (Transparent)</option>
                            <option value="black">Black</option>
                            <option value="dark-gray">Dark Gray</option>
                            <option value="semi-transparent">Semi-Transparent</option>
                            <option value="dark-blue">Dark Blue</option>
                            <option value="dark-red">Dark Red</option>
                            <option value="dark-green">Dark Green</option>
                            <option value="dark-purple">Dark Purple</option>
                            <option value="navy">Navy Blue</option>
                            <option value="charcoal">Charcoal</option>
                        </select>
                    </div>

                    <!-- Outline Thickness -->
                    <div>
                        <label for="caption-outline" class="block text-sm font-medium text-lighter text-black-300 mb-2">Outline Thickness</label>
                        <select id="caption-outline" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="none">None</option>
                            <option value="thin">Thin</option>
                            <option value="medium" selected>Medium</option>
                            <option value="thick">Thick</option>
                            <option value="extra-thick">Extra Thick</option>
                        </select>
                    </div>

                    <!-- Shadow Distance -->
                    <div>
                        <label for="caption-shadow" class="block text-sm font-medium text-lighter text-black-300 mb-2">Shadow Distance</label>
                        <select id="caption-shadow" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="none">None</option>
                            <option value="subtle">Subtle</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                            <option value="extra-large">Extra Large</option>
                        </select>
                    </div>

                    <!-- Caption Position -->
                    <div>
                        <label for="caption-position" class="block text-sm font-medium text-lighter text-black-300 mb-2">Caption Position</label>
                        <select id="caption-position" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="bottom" selected>Bottom Center</option>
                            <option value="top">Top Center</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="top-left">Top Left</option>
                            <option value="top-right">Top Right</option>
                            <option value="middle">Middle Center</option>
                        </select>
                    </div>

                    <!-- Text Alignment -->
                    <div>
                        <label for="caption-alignment" class="block text-sm font-medium text-lighter text-black-300 mb-2">Text Alignment</label>
                        <select id="caption-alignment" class="input-bg w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                            <option value="center" selected>Center</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                        </select>
                    </div>
                </div>

                <!-- Caption Preview -->
                <div class="mt-4">
                    <p class="text-sm font-medium text-lighter text-black-300 mb-2">Caption Preview:</p>
                    <div class="caption-preview">
                        <div class="caption-preview-text" id="caption-preview-text" style="font-size: 20px; color: white; font-family: Arial;">
                            Sample caption text with your settings ❤️
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Container -->
            <div id="status-container" class="mt-6 hidden">
                <div class="inner-bg bg-gray-900/60 border border-gray-700 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span id="status-text" class="font-medium text-cyan-400">Processing...</span>
                        <span id="status-dots" class="status-pulse">•••</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div id="progress-bar" class="bg-gradient-to-r from-purple-500 to-cyan-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p id="status-detail" class="text-sm text-muted text-gray-400 mt-2">Starting process...</p>
                </div>
            </div>

            <!-- Result Container -->
            <div id="result-container" class="mt-8 p-6 inner-bg bg-gray-900/60 border border-gray-700 rounded-lg min-h-[50px] transition-all duration-300 bg-gradient-to-r from-purple-600 to-cyan-500">
                <p id="placeholder-text" class="text-white text-center text-2xl">Your video with embedded subtitles or transcription text will appear here...</p>
            </div>

            <!-- Download Section -->
            <div id="download-section" class="mt-6 hidden">
                <div class="text-center mb-4">
                    <a id="download-link" href="#" class="inline-block px-6 py-3 bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-green-700 hover:to-cyan-700 rounded-lg font-semibold text-white shadow-lg hover:shadow-green-500/30 transition-all duration-300">
                        Download Video with Embedded Subtitles
                    </a>
                </div>
                <div class="mt-4">
                    <video id="preview-video" controls class="w-full rounded-lg" style="max-height: 400px;">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>

            <!-- Transcription Container -->
            <div id="transcription-container" class="mt-6 hidden">
                <h3 class="font-semibold text-lg mb-2 text-light">Transcription:</h3>
                <div class="relative">
                    <pre id="transcription-box" class="input-bg bg-gray-900/60 p-4 rounded border border-gray-700 max-h-64 overflow-auto text-lighter text-gray-200"></pre>
                    <button id="copy-btn" class="copy-btn absolute top-2 right-2 bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">Copy</button>
                    <span id="copied-message" class="copied-message absolute top-2 right-20 text-black">Copied!</span>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div id="history-section" class="hidden mt-6 section-bg bg-gray-800/50 backdrop-blur-md rounded-xl p-6 border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-light">Your History</h2>
                <div class="flex gap-2">
                    <button id="clear-filters-btn" class="px-3 py-1 bg-gray-600 hover:bg-gray-700 rounded text-sm transition-colors hidden">
                        Clear Filters
                    </button>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="mb-6 space-y-4">
                <div class="flex flex-col sm:flex-row gap-4">
                    <!-- Text Search -->
                    <div class="relative flex-1">
                        <input type="text" id="history-search" placeholder="Search by filename..." class="input-bg w-full px-4 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white">
                        <svg class="absolute right-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>

                    <!-- Date Filter -->
                    <div class="flex gap-2">
                        <input type="date" id="history-date-from" class="input-bg px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                        <input type="date" id="history-date-to" class="input-bg px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-cyan-500 outline-none text-white text-sm">
                    </div>
                </div>

                <!-- Filter Pills -->
                <div id="active-filters" class="flex flex-wrap gap-2"></div>

                <!-- Quick Filter Buttons -->
                <div class="flex flex-wrap gap-2">
                    <button class="filter-pill" data-filter="favorites">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"></path></svg>
                        Favorites
                    </button>
                    <button class="filter-pill" data-filter="completed">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Completed
                    </button>
                    <button class="filter-pill" data-filter="failed">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Failed
                    </button>
                    <button class="filter-pill" data-filter="today">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        Today
                    </button>
                    <button class="filter-pill" data-filter="week">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        This Week
                    </button>
                </div>
            </div>

            <!-- History Stats -->
            <div id="history-stats" class="mb-4 text-sm text-gray-400">
                Showing <span id="showing-count">0</span> of <span id="total-count">0</span> items
            </div>

            <div id="history-list" class="space-y-4"></div>

            <!-- Empty State -->
            <div id="history-empty" class="text-center py-12 hidden">
                <svg class="w-16 h-16 mx-auto text-gray-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <p class="text-gray-400 text-lg">No history items found</p>
                <p class="text-gray-500 text-sm mt-2">Try adjusting your filters or process a new video</p>
            </div>
        </div>

        <footer class="text-center mt-8">
            <p class="text-muted text-black-600">© 2025 Scrideo.</p>
        </footer>
    </main>

    <script>
        // DOM Elements
        const transcribeForm = document.getElementById('transcribe-form');
        const urlInput = document.getElementById('youtube-url');
        const pasteBtn = document.getElementById('paste-btn');
        const fileInput = document.getElementById('file-upload');
        const fileLabelText = document.getElementById('file-label-text');
        const fileActions = document.getElementById('file-actions');
        const deleteBtn = document.getElementById('delete-btn');
        const submitButton = document.getElementById('submit-button');
        const submitButtonText = submitButton.querySelector('span');
        const submitButtonIcon = submitButton.querySelector('svg');
        const resultContainer = document.getElementById('result-container');
        const statusContainer = document.getElementById('status-container');
        const statusText = document.getElementById('status-text');
        const statusDetail = document.getElementById('status-detail');
        const progressBar = document.getElementById('progress-bar');
        const downloadSection = document.getElementById('download-section');
        const downloadLink = document.getElementById('download-link');
        const previewVideo = document.getElementById('preview-video');
        const transcriptionContainer = document.getElementById('transcription-container');
        const transcriptionBox = document.getElementById('transcription-box');
        const copyBtn = document.getElementById('copy-btn');
        const copiedMessage = document.getElementById('copied-message');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginModal = document.getElementById('login-modal');
        const signupModal = document.getElementById('signup-modal');
        const loginSubmit = document.getElementById('login-submit');
        const signupSubmit = document.getElementById('signup-submit');
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const signupUsername = document.getElementById('signup-username');
        const signupPassword = document.getElementById('signup-password');
        const signupPasswordConfirm = document.getElementById('signup-password-confirm');
        const loginError = document.getElementById('login-error');
        const signupError = document.getElementById('signup-error');
        const historySection = document.getElementById('history-section');
        const historyList = document.getElementById('history-list');
        const historySearch = document.getElementById('history-search');
        const historyDateFrom = document.getElementById('history-date-from');
        const historyDateTo = document.getElementById('history-date-to');
        const activeFilters = document.getElementById('active-filters');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        const historyStats = document.getElementById('history-stats');
        const showingCount = document.getElementById('showing-count');
        const totalCount = document.getElementById('total-count');
        const historyEmpty = document.getElementById('history-empty');
        const profileSection = document.getElementById('profile-section');
        const profileUsername = document.getElementById('profile-username');
        const profileJobCount = document.getElementById('profile-job-count');
        const profileFavoriteCount = document.getElementById('profile-favorite-count');
        const captionSize = document.getElementById('caption-size');
        const captionColor = document.getElementById('caption-color');
        const captionBgColor = document.getElementById('caption-bg-color');
        const captionFont = document.getElementById('caption-font');
        const captionFontStyle = document.getElementById('caption-font-style');
        const captionPosition = document.getElementById('caption-position');
        const captionAlignment = document.getElementById('caption-alignment');
        const captionOutline = document.getElementById('caption-outline');
        const captionShadow = document.getElementById('caption-shadow');
        const captionPreviewText = document.getElementById('caption-preview-text');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIconSun = document.getElementById('theme-icon-sun');
        const themeIconMoon = document.getElementById('theme-icon-moon');
        const notificationContainer = document.getElementById('notification-container');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

        let allHistoryJobs = [];
        let currentFilters = {
            search: '',
            dateFrom: '',
            dateTo: '',
            favorites: false,
            status: '',
            quickFilter: ''
        };
        let jobToDelete = null;

        const statusMessages = {
            'uploaded': { text: 'File Uploaded', progress: 10, detail: 'Video file successfully uploaded' },
            'downloading': { text: 'Downloading Video', progress: 20, detail: 'Downloading video from YouTube...' },
            'transcribing': { text: 'Transcribing Audio', progress: 40, detail: 'Converting speech to text...' },
            'generating_captions': { text: 'Generating Subtitles', progress: 70, detail: 'Creating subtitle timings...' },
            'embedding_subtitles': { text: 'Embedding Subtitles', progress: 85, detail: 'Adding subtitles to video...' },
            'completed': { text: 'Completed', progress: 100, detail: 'Video with subtitles is ready!' },
            'completed_transcription_only': { text: 'Transcription Complete', progress: 100, detail: 'Transcription text is ready!' }
        };

        const colorMapCSS = {
            'white': '#FFFFFF', 'yellow': '#FFFF00', 'cyan': '#00FFFF', 'lime': '#00FF00',
            'orange': '#FFA500', 'red': '#FF0000', 'pink': '#FFC0CB', 'purple': '#A020F0',
            'light-blue': '#ADD8E6', 'light-green': '#90EE90'
        };

        const bgColorMapCSS = {
            'none': 'transparent', 'black': 'rgba(0, 0, 0, 0.8)', 'dark-gray': 'rgba(51, 51, 51, 0.8)',
            'semi-transparent': 'rgba(0, 0, 0, 0.6)', 'dark-blue': 'rgba(0, 26, 77, 0.8)',
            'dark-red': 'rgba(77, 0, 0, 0.8)', 'dark-green': 'rgba(0, 77, 0, 0.8)',
            'dark-purple': 'rgba(51, 0, 77, 0.8)', 'navy': 'rgba(0, 0, 128, 0.8)',
            'charcoal': 'rgba(54, 69, 79, 0.8)'
        };

        const fontFamilyMapCSS = {
            'arial': 'Arial, sans-serif', 'helvetica': 'Helvetica, sans-serif',
            'times-new-roman': '"Times New Roman", serif', 'courier-new': '"Courier New", monospace',
            'verdana': 'Verdana, sans-serif', 'georgia': 'Georgia, serif', 'impact': 'Impact, sans-serif',
            'comic-sans': '"Comic Sans MS", cursive', 'trebuchet': '"Trebuchet MS", sans-serif',
            'arial-black': '"Arial Black", sans-serif', 'palatino': '"Palatino Linotype", serif'
        };

        // Notification System
        function showNotification(message, type = 'success', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>',
                error: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
                info: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'
            };

            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-icon">${icons[type] || icons.info}</div>
                    <div class="notification-message">${message}</div>
                    <button class="notification-close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            `;

            notificationContainer.appendChild(notification);

            // Trigger browser notification if permitted
            if (type === 'success' && Notification.permission === 'granted') {
                new Notification('Scrideo - Processing Complete', {
                    body: message,
                    icon: '/favicon.ico',
                    tag: 'scrideo-complete'
                });
            }

            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);

            // Close button event
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                closeNotification(notification);
            });

            // Auto-remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        closeNotification(notification);
                    }
                }, duration);
            }

            return notification;
        }

        function closeNotification(notification) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Notification permission granted');
                    }
                });
            }
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                themeIconSun.classList.remove('hidden');
                themeIconMoon.classList.add('hidden');
            } else {
                document.body.classList.remove('light-theme');
                themeIconSun.classList.add('hidden');
                themeIconMoon.classList.remove('hidden');
            }
        }

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            const isLight = document.body.classList.contains('light-theme');
            if (isLight) {
                themeIconSun.classList.remove('hidden');
                themeIconMoon.classList.add('hidden');
                localStorage.setItem('theme', 'light');
            } else {
                themeIconSun.classList.add('hidden');
                themeIconMoon.classList.remove('hidden');
                localStorage.setItem('theme', 'dark');
            }
        });

        function updateCaptionPreview() {
            const size = captionSize.value;
            const color = captionColor.value;
            const bgColor = captionBgColor.value;
            const font = captionFont.value;
            const fontStyle = captionFontStyle.value;
            const position = captionPosition.value;
            const alignment = captionAlignment.value;
            const outline = captionOutline.value;
            const shadow = captionShadow.value;
            
            captionPreviewText.style.fontSize = size + 'px';
            captionPreviewText.style.color = colorMapCSS[color] || '#FFFFFF';
            captionPreviewText.style.backgroundColor = bgColorMapCSS[bgColor] || 'transparent';
            captionPreviewText.style.fontFamily = fontFamilyMapCSS[font] || 'Arial, sans-serif';
            captionPreviewText.style.fontWeight = (fontStyle === 'bold' || fontStyle === 'bold-italic') ? 'bold' : 'normal';
            captionPreviewText.style.fontStyle = (fontStyle === 'italic' || fontStyle === 'bold-italic') ? 'italic' : 'normal';
            captionPreviewText.style.textAlign = alignment;
            
            let textShadowValue = '';
            
            if (outline !== 'none') {
                const outlineSize = { 'thin': 1, 'medium': 2, 'thick': 3, 'extra-thick': 4 }[outline] || 2;
                const outlineShadows = [];
                for (let angle = 0; angle < 360; angle += 45) {
                    const radian = angle * Math.PI / 180;
                    const x = Math.cos(radian) * outlineSize;
                    const y = Math.sin(radian) * outlineSize;
                    outlineShadows.push(`${x.toFixed(1)}px ${y.toFixed(1)}px 0 #000000`);
                }
                textShadowValue = outlineShadows.join(', ');
            }
            
            if (shadow !== 'none') {
                const shadowSize = { 'subtle': 2, 'medium': 3, 'large': 4, 'extra-large': 6 }[shadow] || 3;
                const dropShadow = `${shadowSize}px ${shadowSize}px ${shadowSize}px rgba(0, 0, 0, 0.8)`;
                textShadowValue = textShadowValue ? `${textShadowValue}, ${dropShadow}` : dropShadow;
            }
            
            captionPreviewText.style.textShadow = textShadowValue || 'none';
            
            const previewContainer = captionPreviewText.parentElement;
            previewContainer.style.justifyContent = getJustifyContent(position);
            previewContainer.style.alignItems = getAlignItems(position);
            
            if (bgColor !== 'none') {
                captionPreviewText.style.padding = '10px 16px';
                captionPreviewText.style.borderRadius = '4px';
                captionPreviewText.style.display = 'inline-block';
            } else {
                captionPreviewText.style.padding = '0';
                captionPreviewText.style.borderRadius = '0';
                captionPreviewText.style.display = 'block';
            }
        }

        function getJustifyContent(position) {
            switch(position) {
                case 'bottom-left': case 'top-left': return 'flex-start';
                case 'bottom-right': case 'top-right': return 'flex-end';
                default: return 'center';
            }
        }

        function getAlignItems(position) {
            switch(position) {
                case 'top': case 'top-left': case 'top-right': return 'flex-start';
                case 'middle': return 'center';
                default: return 'flex-end';
            }
        }

        captionSize.addEventListener('change', updateCaptionPreview);
        captionColor.addEventListener('change', updateCaptionPreview);
        captionBgColor.addEventListener('change', updateCaptionPreview);
        captionFont.addEventListener('change', updateCaptionPreview);
        captionFontStyle.addEventListener('change', updateCaptionPreview);
        captionPosition.addEventListener('change', updateCaptionPreview);
        captionAlignment.addEventListener('change', updateCaptionPreview);
        captionOutline.addEventListener('change', updateCaptionPreview);
        captionShadow.addEventListener('change', updateCaptionPreview);

        function getCaptionSettings() {
            return {
                size: captionSize.value,
                color: captionColor.value,
                bgColor: captionBgColor.value,
                font: captionFont.value,
                fontStyle: captionFontStyle.value,
                position: captionPosition.value,
                alignment: captionAlignment.value,
                outlineThickness: captionOutline.value,
                shadowDistance: captionShadow.value
            };
        }

        function showModal(modalId) { 
            document.getElementById(modalId).style.display = 'block'; 
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'login-modal' || modalId === 'signup-modal') {
                loginError.classList.add('hidden');
                signupError.classList.add('hidden');
                loginUsername.value = '';
                loginPassword.value = '';
                signupUsername.value = '';
                signupPassword.value = '';
                signupPasswordConfirm.value = '';
            }
            if (modalId === 'delete-confirm-modal') {
                jobToDelete = null;
            }
        }

        function updateUIForLoginState() {
            const token = localStorage.getItem('token');
            if (token) {
                loginBtn.classList.add('hidden');
                signupBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                fetchProfileAndHistory();
            } else {
                loginBtn.classList.remove('hidden');
                signupBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                profileSection.classList.add('hidden');
                historySection.classList.add('hidden');
            }
        }

        async function fetchProfileAndHistory() {
            const token = localStorage.getItem('token');
            if (!token) return;
            try {
                const response = await fetch('/profile', { headers: { 'Authorization': `Bearer ${token}` }});
                if (!response.ok) throw new Error('Failed to fetch profile');
                const data = await response.json();
                profileSection.classList.remove('hidden');
                profileUsername.textContent = data.username;
                profileJobCount.textContent = data.job_count;
                profileFavoriteCount.textContent = data.favorite_count || 0;
                historySection.classList.remove('hidden');
                allHistoryJobs = data.history || [];
                applyFilters();
            } catch (error) {
                console.error('Profile/history fetch error:', error);
            }
        }

        // Filter Functions
        function applyFilters() {
            let filteredJobs = [...allHistoryJobs];
            
            // Text search filter
            if (currentFilters.search) {
                filteredJobs = filteredJobs.filter(job => 
                    job.filename.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
                    (job.transcription && job.transcription.toLowerCase().includes(currentFilters.search.toLowerCase()))
                );
            }
            
            // Date range filter
            if (currentFilters.dateFrom) {
                filteredJobs = filteredJobs.filter(job => job.date >= currentFilters.dateFrom);
            }
            if (currentFilters.dateTo) {
                filteredJobs = filteredJobs.filter(job => job.date <= currentFilters.dateTo);
            }
            
            // Favorites filter
            if (currentFilters.favorites) {
                filteredJobs = filteredJobs.filter(job => job.favorited);
            }
            
            // Status filter
            if (currentFilters.status) {
                filteredJobs = filteredJobs.filter(job => job.status === currentFilters.status);
            }
            
            // Quick filters
            if (currentFilters.quickFilter === 'today') {
                const today = new Date().toISOString().split('T')[0];
                filteredJobs = filteredJobs.filter(job => job.date === today);
            } else if (currentFilters.quickFilter === 'week') {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const oneWeekAgoStr = oneWeekAgo.toISOString().split('T')[0];
                filteredJobs = filteredJobs.filter(job => job.date >= oneWeekAgoStr);
            }
            
            renderHistory(filteredJobs);
            updateActiveFiltersDisplay();
            updateStats(filteredJobs.length);
        }

        function updateStats(shownCount) {
            showingCount.textContent = shownCount;
            totalCount.textContent = allHistoryJobs.length;
            
            if (shownCount === 0 && allHistoryJobs.length > 0) {
                historyEmpty.classList.remove('hidden');
                historyList.classList.add('hidden');
            } else {
                historyEmpty.classList.add('hidden');
                historyList.classList.remove('hidden');
            }
        }

        function updateActiveFiltersDisplay() {
            activeFilters.innerHTML = '';
            let hasActiveFilters = false;
            
            // Search filter
            if (currentFilters.search) {
                hasActiveFilters = true;
                const pill = createFilterPill(`Search: "${currentFilters.search}"`, 'search');
                activeFilters.appendChild(pill);
            }
            
            // Date filters
            if (currentFilters.dateFrom) {
                hasActiveFilters = true;
                const pill = createFilterPill(`From: ${currentFilters.dateFrom}`, 'dateFrom');
                activeFilters.appendChild(pill);
            }
            if (currentFilters.dateTo) {
                hasActiveFilters = true;
                const pill = createFilterPill(`To: ${currentFilters.dateTo}`, 'dateTo');
                activeFilters.appendChild(pill);
            }
            
            // Favorites filter
            if (currentFilters.favorites) {
                hasActiveFilters = true;
                const pill = createFilterPill('Favorites', 'favorites');
                activeFilters.appendChild(pill);
            }
            
            // Status filter
            if (currentFilters.status) {
                hasActiveFilters = true;
                const pill = createFilterPill(`Status: ${currentFilters.status}`, 'status');
                activeFilters.appendChild(pill);
            }
            
            // Quick filter
            if (currentFilters.quickFilter) {
                hasActiveFilters = true;
                const displayName = {
                    'today': 'Today',
                    'week': 'This Week',
                    'completed': 'Completed',
                    'failed': 'Failed'
                }[currentFilters.quickFilter] || currentFilters.quickFilter;
                const pill = createFilterPill(displayName, 'quickFilter');
                activeFilters.appendChild(pill);
            }
            
            clearFiltersBtn.classList.toggle('hidden', !hasActiveFilters);
        }

        function createFilterPill(text, filterType) {
            const pill = document.createElement('div');
            pill.className = 'filter-pill active';
            pill.innerHTML = `
                ${text}
                <span class="close" data-filter="${filterType}">&times;</span>
            `;
            
            pill.querySelector('.close').addEventListener('click', (e) => {
                e.stopPropagation();
                removeFilter(filterType);
            });
            
            return pill;
        }

        function removeFilter(filterType) {
            switch(filterType) {
                case 'search':
                    currentFilters.search = '';
                    historySearch.value = '';
                    break;
                case 'dateFrom':
                    currentFilters.dateFrom = '';
                    historyDateFrom.value = '';
                    break;
                case 'dateTo':
                    currentFilters.dateTo = '';
                    historyDateTo.value = '';
                    break;
                case 'favorites':
                    currentFilters.favorites = false;
                    break;
                case 'status':
                    currentFilters.status = '';
                    break;
                case 'quickFilter':
                    currentFilters.quickFilter = '';
                    break;
            }
            applyFilters();
        }

        function clearAllFilters() {
            currentFilters = {
                search: '',
                dateFrom: '',
                dateTo: '',
                favorites: false,
                status: '',
                quickFilter: ''
            };
            historySearch.value = '';
            historyDateFrom.value = '';
            historyDateTo.value = '';
            applyFilters();
        }

        // Event Listeners for Filters
        historySearch.addEventListener('input', (e) => {
            currentFilters.search = e.target.value;
            applyFilters();
        });

        historyDateFrom.addEventListener('change', (e) => {
            currentFilters.dateFrom = e.target.value;
            applyFilters();
        });

        historyDateTo.addEventListener('change', (e) => {
            currentFilters.dateTo = e.target.value;
            applyFilters();
        });

        clearFiltersBtn.addEventListener('click', clearAllFilters);

        // Quick filter buttons
        document.querySelectorAll('.filter-pill[data-filter]').forEach(button => {
            button.addEventListener('click', (e) => {
                const filter = e.currentTarget.dataset.filter;
                
                // Toggle quick filters
                if (['favorites', 'completed', 'failed', 'today', 'week'].includes(filter)) {
                    if (filter === 'favorites') {
                        currentFilters.favorites = !currentFilters.favorites;
                    } else if (filter === 'completed') {
                        currentFilters.status = currentFilters.status === 'completed' ? '' : 'completed';
                    } else if (filter === 'failed') {
                        currentFilters.status = currentFilters.status === 'failed' ? '' : 'failed';
                    } else {
                        currentFilters.quickFilter = currentFilters.quickFilter === filter ? '' : filter;
                    }
                    applyFilters();
                }
            });
        });

        loginBtn.addEventListener('click', () => showModal('login-modal'));
        signupBtn.addEventListener('click', () => showModal('signup-modal'));
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('token');
            updateUIForLoginState();
            showNotification('Logged out successfully', 'info');
        });

        loginSubmit.addEventListener('click', async () => {
            const username = loginUsername.value.trim();
            const password = loginPassword.value;
            if (!username || !password) {
                loginError.textContent = 'Please fill in all fields';
                loginError.classList.remove('hidden');
                return;
            }
            loginSubmit.disabled = true;
            loginSubmit.textContent = 'Logging in...';
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'Login failed');
                localStorage.setItem('token', data.token);
                closeModal('login-modal');
                updateUIForLoginState();
                showNotification('Login successful!', 'success');
            } catch (error) {
                loginError.textContent = error.message;
                loginError.classList.remove('hidden');
                showNotification(`Login failed: ${error.message}`, 'error');
            } finally {
                loginSubmit.disabled = false;
                loginSubmit.textContent = 'Login';
            }
        });

        signupSubmit.addEventListener('click', async () => {
            const username = signupUsername.value.trim();
            const password = signupPassword.value;
            const passwordConfirm = signupPasswordConfirm.value;
            if (!username || !password || !passwordConfirm) {
                signupError.textContent = 'Please fill in all fields';
                signupError.classList.remove('hidden');
                return;
            }
            if (username.length < 3) {
                signupError.textContent = 'Username must be at least 3 characters';
                signupError.classList.remove('hidden');
                return;
            }
            if (password.length < 6) {
                signupError.textContent = 'Password must be at least 6 characters';
                signupError.classList.remove('hidden');
                return;
            }
            if (password !== passwordConfirm) {
                signupError.textContent = 'Passwords do not match';
                signupError.classList.remove('hidden');
                return;
            }
            signupSubmit.disabled = true;
            signupSubmit.textContent = 'Signing up...';
            try {
                const response = await fetch('/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password, password_confirm: passwordConfirm })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'Signup failed');
                localStorage.setItem('token', data.token);
                closeModal('signup-modal');
                updateUIForLoginState();
                showNotification('Account created successfully!', 'success');
            } catch (error) {
                signupError.textContent = error.message;
                signupError.classList.remove('hidden');
                showNotification(`Signup failed: ${error.message}`, 'error');
            } finally {
                signupSubmit.disabled = false;
                signupSubmit.textContent = 'Signup';
            }
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileLabelText.textContent = fileInput.files[0].name;
                fileActions.classList.remove('hidden');
                urlInput.value = '';
            } else {
                fileLabelText.textContent = 'Click to upload a video file';
                fileActions.classList.add('hidden');
            }
        });

        deleteBtn.addEventListener('click', (e) => {
            e.preventDefault();
            fileInput.value = '';
            fileLabelText.textContent = 'Click to upload a video file';
            fileActions.classList.add('hidden');
        });

        // Add paste functionality
        pasteBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    urlInput.value = text;
                    // Clear file input when pasting URL
                    fileInput.value = '';
                    fileLabelText.textContent = 'Click to upload a video file';
                    fileActions.classList.add('hidden');
                }
            } catch (err) {
                console.error('Failed to read clipboard contents: ', err);
                showNotification('Unable to paste from clipboard. Please paste manually.', 'error');
            }
        });

        function updateButtonState(processing) {
            if (processing) {
                submitButton.disabled = true;
                submitButtonText.textContent = 'Processing...';
                submitButtonIcon.classList.add('spinner');
                submitButton.style.opacity = '0.7';
                submitButton.style.cursor = 'not-allowed';
            } else {
                submitButton.disabled = false;
                submitButtonText.textContent = 'Generate';
                submitButtonIcon.classList.remove('spinner');
                submitButton.style.opacity = '1';
                submitButton.style.cursor = 'pointer';
            }
        }

        function showStatus(message, detail, progress) {
            statusContainer.classList.remove('hidden');
            statusText.textContent = message;
            statusDetail.textContent = detail;
            progressBar.style.width = `${progress}%`;
        }

        function hideStatus() {
            statusContainer.classList.add('hidden');
        }

        function showResult(message, isError = false) {
            resultContainer.innerHTML = '';
            if (isError) {
                resultContainer.innerHTML = `<p class="text-red-400 text-center text-xl">${message}</p>`;
            } else {
                resultContainer.innerHTML = `<p class="text-white text-center text-xl">${message}</p>`;
            }
        }

        transcribeForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const youtubeURL = urlInput.value.trim();
            const uploadedFile = fileInput.files[0];
            
            if (!youtubeURL && !uploadedFile) {
                showNotification("Please provide a YouTube URL or upload a video file.", "error");
                return;
            }

            // Update UI immediately
            updateButtonState(true);
            showStatus('Starting process...', 'Preparing to process your video...', 5);
            resultContainer.innerHTML = '';
            downloadSection.classList.add('hidden');
            transcriptionContainer.classList.add('hidden');
            
            try {
                const token = localStorage.getItem('token');
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const captionSettings = getCaptionSettings();
                let response;
                
                if (uploadedFile) {
                    showStatus('Uploading file...', 'Uploading your video file...', 10);
                    const formData = new FormData();
                    formData.append('video', uploadedFile);
                    formData.append('captionSettings', JSON.stringify(captionSettings));
                    response = await fetch('/upload', { method: 'POST', body: formData, headers });
                } else {
                    showStatus('Processing YouTube URL...', 'Preparing to download from YouTube...', 15);
                    response = await fetch('/transcribe', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', ...headers },
                        body: JSON.stringify({ url: youtubeURL, captionSettings }),
                    });
                }
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Server error');
                }
                
                const data = await response.json();
                showStatus('Processing started...', 'Your video is now being processed...', 20);
                showNotification('Video processing started! We\'ll notify you when it\'s ready.', 'info', 3000);
                pollStatus(data.job_id);
                
            } catch (error) {
                console.error('Processing error:', error);
                showResult(`Error: ${error.message}`, true);
                showNotification(`Processing failed: ${error.message}`, 'error');
                updateButtonState(false);
                hideStatus();
            }
        });

        async function pollStatus(jobId) {
            const interval = setInterval(async () => {
                try {
                    const token = localStorage.getItem('token');
                    const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                    const response = await fetch(`/status/${jobId}`, { headers });
                    if (!response.ok) throw new Error('Status check failed');
                    const status = await response.json();
                    
                    if (statusMessages[status.status]) {
                        const info = statusMessages[status.status];
                        showStatus(info.text, info.detail, info.progress);
                    }
                    
                    if (status.status === 'completed') {
                        clearInterval(interval);
                        showStatus('Completed!', 'Your video is ready!', 100);
                        
                        // Show completion notification
                        const filename = status.filename || 'your video';
                        showNotification(
                            `🎉 Video processing complete! "${filename}" with embedded subtitles is ready for download.`,
                            'success',
                            8000
                        );
                        
                        // Small delay to show completion status
                        setTimeout(() => {
                            hideStatus();
                            showResult('Processing Complete! Your video with embedded subtitles is ready.');
                            downloadSection.classList.remove('hidden');
                            transcriptionContainer.classList.remove('hidden');
                            downloadLink.href = status.download_url || '#';
                            previewVideo.src = status.download_url || '';
                            transcriptionBox.textContent = status.transcription || 'Not available';
                            updateButtonState(false);
                            fetchProfileAndHistory();
                        }, 1000);
                        
                    } else if (status.status === 'failed') {
                        clearInterval(interval);
                        const errorMsg = status.error || 'Unknown error';
                        showResult(`Processing failed: ${errorMsg}`, true);
                        showNotification(`Processing failed: ${errorMsg}`, 'error');
                        updateButtonState(false);
                        hideStatus();
                        fetchProfileAndHistory();
                    }
                } catch (error) {
                    clearInterval(interval);
                    showResult('Connection error while checking status', true);
                    showNotification('Connection error while checking processing status', 'error');
                    updateButtonState(false);
                    hideStatus();
                }
            }, 2000);
        }

        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(transcriptionBox.textContent).then(() => {
                copiedMessage.style.display = 'inline';
                showNotification('Transcription copied to clipboard!', 'success', 2000);
                setTimeout(() => { copiedMessage.style.display = 'none'; }, 2000);
            });
        });

        function renderHistory(jobs) {
            if (!jobs || jobs.length === 0) {
                historyList.innerHTML = '<p class="text-gray-400 text-center py-8">No history items match your filters</p>';
                historyEmpty.classList.remove('hidden');
                historyList.classList.add('hidden');
                return;
            }
            
            historyEmpty.classList.add('hidden');
            historyList.classList.remove('hidden');
            
            historyList.innerHTML = jobs.map(job => `
                <div class="history-item inner-bg bg-gray-900/60 p-4 rounded-lg border border-gray-700">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3 flex-1">
                            <button class="favorite-star ${job.favorited ? 'favorited' : ''}" data-job-id="${job.job_id}" title="${job.favorited ? 'Remove from favorites' : 'Add to favorites'}">
                                <svg class="w-5 h-5" fill="${job.favorited ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z"></path>
                                </svg>
                            </button>
                            <div class="flex-1 min-w-0">
                                <p class="text-lighter font-semibold mb-1 truncate" title="${job.filename}"><strong>File:</strong> ${job.filename}</p>
                                <p class="text-lighter mb-1"><strong>Status:</strong> <span class="${job.status === 'completed' ? 'text-green-400' : job.status === 'failed' ? 'text-red-400' : 'text-yellow-400'}">${job.status}</span></p>
                            </div>
                        </div>
                        <div class="history-actions flex gap-2 ml-4">
                            ${job.download_url ? `
                                <a href="${job.download_url}" class="px-3 py-1 bg-cyan-600 hover:bg-cyan-700 rounded text-sm transition-colors flex items-center gap-1" title="Download">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                </a>
                            ` : ''}
                            <button class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm transition-colors flex items-center gap-1 delete-history-btn" data-job-id="${job.job_id}" title="Delete from history">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                    
                    ${job.transcription ? `
                        <div class="mb-3">
                            <p class="text-lighter text-sm mb-1"><strong>Transcription Preview:</strong></p>
                            <p class="text-gray-400 text-sm line-clamp-2">${job.transcription.substring(0, 150)}${job.transcription.length > 150 ? '...' : ''}</p>
                        </div>
                    ` : ''}
                    
                    <div class="flex justify-between items-center text-sm text-gray-400">
                        <div class="flex gap-4">
                            <span>${job.date || 'N/A'}</span>
                            <span>${job.time || 'N/A'}</span>
                            <span>${job.duration || 'N/A'}</span>
                        </div>
                        ${job.download_url ? `
                            <a href="${job.download_url}" class="text-cyan-400 hover:underline text-sm">
                                Download Video
                            </a>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            // Add event listeners for favorite stars
            document.querySelectorAll('.favorite-star').forEach(star => {
                star.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const jobId = e.currentTarget.dataset.jobId;
                    await toggleFavorite(jobId);
                });
            });
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-history-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const jobId = e.currentTarget.dataset.jobId;
                    showDeleteConfirmation(jobId);
                });
            });
        }

        async function toggleFavorite(jobId) {
            const token = localStorage.getItem('token');
            if (!token) {
                showNotification('You must be logged in to favorite items', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/history/${jobId}/favorite`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to toggle favorite');
                }
                
                const result = await response.json();
                
                // Update local data
                const jobIndex = allHistoryJobs.findIndex(job => job.job_id === jobId);
                if (jobIndex !== -1) {
                    allHistoryJobs[jobIndex].favorited = result.favorited;
                }
                
                // Update UI
                applyFilters();
                fetchProfileAndHistory(); // Refresh profile stats
                
                showNotification(
                    result.favorited ? 'Added to favorites!' : 'Removed from favorites!',
                    'success',
                    2000
                );
                
            } catch (error) {
                console.error('Favorite toggle error:', error);
                showNotification(error.message || 'Failed to update favorite', 'error');
            }
        }

        function showDeleteConfirmation(jobId) {
            const job = allHistoryJobs.find(j => j.job_id === jobId);
            if (!job) {
                showNotification('Job not found', 'error');
                return;
            }
            
            jobToDelete = jobId;
            
            // Update modal text to show which file is being deleted
            const modal = document.getElementById('delete-confirm-modal');
            const filename = job.filename || 'this video';
            modal.querySelector('p').textContent = `Are you sure you want to delete "${filename}" from your history? This action cannot be undone.`;
            
            showModal('delete-confirm-modal');
        }

        // Delete confirmation event listener
        confirmDeleteBtn.addEventListener('click', async () => {
            if (!jobToDelete) {
                showNotification('No job selected for deletion', 'error');
                closeModal('delete-confirm-modal');
                return;
            }
            
            const token = localStorage.getItem('token');
            if (!token) {
                showNotification('You must be logged in to delete history', 'error');
                closeModal('delete-confirm-modal');
                return;
            }
            
            // Disable button during deletion
            confirmDeleteBtn.disabled = true;
            confirmDeleteBtn.textContent = 'Deleting...';
            
            try {
                const response = await fetch(`/history/${jobToDelete}`, {
                    method: 'DELETE',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to delete history item');
                }
                
                // Remove from local data
                allHistoryJobs = allHistoryJobs.filter(job => job.job_id !== jobToDelete);
                
                // Update UI
                applyFilters();
                fetchProfileAndHistory();
                
                showNotification('History item deleted successfully', 'success');
                closeModal('delete-confirm-modal');
                
            } catch (error) {
                console.error('Delete error:', error);
                showNotification(error.message || 'Failed to delete history item', 'error');
            } finally {
                confirmDeleteBtn.disabled = false;
                confirmDeleteBtn.textContent = 'Delete';
                jobToDelete = null;
            }
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            const deleteModal = document.getElementById('delete-confirm-modal');
            if (event.target === deleteModal) {
                closeModal('delete-confirm-modal');
                jobToDelete = null;
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Scrideo - Video Transcription Service initialized');
            updateUIForLoginState();
            updateCaptionPreview();
            initializeTheme();
            requestNotificationPermission();
        });
    </script>
</body>
</html>